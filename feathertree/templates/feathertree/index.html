{% extends "feathertree/base.html" %}

{% block head %}
<title>Feathertree</title>
<meta name="description" content="Welcome to Feathertree — a collaborative storytelling platform where authors build branching tales together.">
{% endblock head %}

{% block body %}
{% include "feathertree/_header.html" %}

<main class="container content">

  {# --- welcome section --- #}
  {% if user.is_authenticated %}

  <section class="welcome-section">
    <h1>Welcome back, {{ user.display_name }}!</h1>
    <p class="subtitle">Continue your journey of creating and exploring stories.</p>

    <div class="button-group">
      <a class="btn primary" href="{% url 'feathertree:story_create' %}">Create a New Story</a>
      <a class="btn secondary" href="{% url 'feathertree:user_profile' user.pk %}">Your Stories</a>
    </div>
  </section>

  {% else %}

  <section class="hero">
    <h1 class="hero-title">Feathertree</h1>
    <p class="hero-subtitle">A branching storybook for collective imagination.</p>
    <a class="btn primary" href="{% url 'feathertree:user_create' %}">Sign Up To Get Started</a>
  </section>

  {% endif %}

  <section class="story-list-section">
    <header class="story-list-header">
      <h2>Recently Updated Stories</h2>
      <p class="story-list-subtitle">
        New and freshly updated stories from across Feathertree.
      </p>
    </header>

    {% if stories_page and stories_page.object_list %}
      <ul class="story-list">
        {% for story in stories_page %}
          <li class="story-card">
            <h3 class="story-card-title">
              <a href="{% url 'feathertree:story_view' story.id %}">
                {{ story.title|default:"Untitled Story" }}
              </a>
            </h3>

            <p class="story-meta">
              {% if story.last_updated %}
                · <span>Updated {{ story.last_updated|date:"F j, Y" }}</span>
              {% endif %}
            </p>
            {# Include story summary here if wanted... update with LLM too? #}
          </li>
        {% endfor %}
      </ul>

      {# --- Pagination controls --- #}
      {% if stories_page.has_other_pages %}
        <nav class="pagination" aria-label="Story list pagination">
          {% if stories_page.has_previous %}
            <a class="page-link" href="?page={{ stories_page.previous_page_number }}">&laquo; Previous</a>
          {% else %}
            <span class="page-link disabled">&laquo; Previous</span>
          {% endif %}

          <span class="page-info">
            Page {{ stories_page.number }} of {{ stories_page.paginator.num_pages }}
          </span>

          {% if stories_page.has_next %}
            <a class="page-link" href="?page={{ stories_page.next_page_number }}">Next &raquo;</a>
          {% else %}
            <span class="page-link disabled">Next &raquo;</span>
          {% endif %}
        </nav>
      {% endif %}

    {% else %}
      <p><em>No stories have been published yet.</em>
        {% if user.is_authenticated %}
          Why not <a href="{% url 'feathertree:story_create' %}">create the first one</a>?
        {% endif %}
      </p>
    {% endif %}
  </section>

</main>
{% endblock body %}
